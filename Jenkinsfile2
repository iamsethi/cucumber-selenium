pipeline {
    agent any
    stages {
        stage('Pull Latest Image') {
            steps {
                sh 'docker pull iamsethi/cucumber-selenium-docker'
            }
        }
        stage('Run Test') {
            steps {
               script {
                    def parallelTests = [:]  // creates empty map
                    def builders = [:]
                  	packageJson = readJSON file: ('tests.json')
					parallelTests = packageJson.scripts
					parallelTests.each{ k, v -> 					
					builders["chrome-tests"] = {
      				node("${k}") {
       					echo("${v}") // build steps that should happen on all nodes go here
     						 }
    					}			
										
					}		
					
					parallel builders,failFast = true
                }
        }
        }
       
        }
    post{
    always
    {
   	archiveArtifacts artifacts: 'chrome/**', fingerprint: true
   	archiveArtifacts artifacts: 'firefox/**', fingerprint: true
    }
    
    }
    
    
}




